# モジュール1: Microsoft 365 テナントの展開と管理 (試験比重: 15-20%)

## はじめに (モジュール1の学習を始めるにあたって)

このモジュールでは、Microsoft 365 環境の基盤となるテナントのセットアップ、基本的な構成、そして日常的な管理タスクについて学習します。組織が Microsoft 365 を効果的かつ安全に利用するための第一歩となる重要な知識を習得します。

**学習目標:**

* Microsoft 365 テナントの初期設定と組織プロファイルの構成方法を理解する。
* カスタムドメインを追加し、DNSレコードを正しく構成する手順を習得する。
* ユーザーアカウントと様々な種類のグループを作成・管理する方法を理解する。
* Microsoft 365 ライセンスを効率的に割り当て、管理する方法を習得する。
* 組み込みロールと管理単位を活用した権限管理の基本を理解する。
* サービス正常性とメッセージセンターを監視し、テナントの状態を把握する方法を習得する。

---

## 1.1 テナントの初期設定と構成

### Microsoft 365 テナントとは？

* **定義**: Microsoft 365 テナントは、組織専用に分離されたMicrosoft 365サービスのインスタンス（独立した環境）です。
* **特徴**:
    * 独自のID管理（Microsoft Entra IDと連携）。
    * サービスごとのカスタマイズ可能な構成。
    * 組織のデータが格納される場所。
    * 例えるなら、組織専用の「オフィスビル」のようなものです。各フロアがサービス（Exchange Online, SharePoint Onlineなど）に相当し、入館証がユーザーIDとなります。

### テナントの作成とサブスクリプション

* **テナント作成のきっかけ**:
    * Microsoft 365 の試用版サインアップ。
    * 有料サブスクリプションの直接購入。
* **サブスクリプションとライセンス**:
    * **サブスクリプション**: Microsoft 365 のサービスを利用するための契約。期間や支払い方法が定義されます。（例: Microsoft 365 E3 年間契約）
    * **ライセンス**: サブスクリプション内で、個々のユーザーが特定のサービスを利用する権利。（例: Microsoft 365 E3 ライセンス）
    * **主要なライセンスプランの比較 (簡易版)**:
        | プラン                 | 主な対象         | 主要機能 (例)                                                                 |
        | ---------------------- | ---------------- | ----------------------------------------------------------------------------- |
        | Microsoft 365 Business Basic | 中小企業（300ユーザー以下） | Web版Officeアプリ, Exchange, Teams, OneDrive, SharePoint                         |
        | Microsoft 365 Business Standard| 中小企業（300ユーザー以下） | Business Basic + デスクトップ版Officeアプリ                                      |
        | Microsoft 365 Business Premium | 中小企業（300ユーザー以下） | Business Standard + 高度なセキュリティ (Defender for Business), Intune         |
        | Microsoft 365 E3       | 大企業           | デスクトップ版Office, Exchange, Teams, OneDrive, SharePoint, 基本的なセキュリティ・コンプライアンス |
        | Microsoft 365 E5       | 大企業           | E3 + 高度なセキュリティ(Defender P2), コンプライアンス(Purview), Power BI Pro, 電話会議  |
    * **選択のポイント**: 組織の規模、必要な機能（特にセキュリティとコンプライアンス）、予算を考慮します。

### 組織プロファイルの構成

* **目的**: Microsoft 365 テナントに関する組織の基本情報を設定し、Microsoft とのコミュニケーションや一部サービスの表示に利用されます。
* **設定項目**:
    * **組織名**: Microsoft との契約やサポートで使用される正式な組織名。
    * **住所、電話番号など**: 連絡先情報。
    * **技術連絡先**: Microsoft からの技術的な通知（サービス障害、メンテナンスなど）を受け取る担当者のメールアドレス。非常に重要です。
    * **優先言語**: 管理センターや一部のユーザー向け通知で使用される言語。
    * **地域**: データの保存場所（データセンターのリージョン）の選択に影響することがあります（初期設定時）。
* **手順 (Microsoft 365 管理センター)**:
    1.  Microsoft 365 管理センター (`admin.microsoft.com`) にグローバル管理者としてサインインします。
    2.  左側のナビゲーションメニューから `[設定]` > `[組織設定]` を選択します。
    3.  `[組織のプロファイル]` タブを選択します。
    4.  `[組織情報]` をクリックし、必要な情報を編集・保存します。
        <img width="1879" alt="image" src="https://github.com/user-attachments/assets/4cdb2dd5-02df-4cc9-9a82-31fbb1c92ddd" />

* **注意点**: 技術連絡先には、実際に通知を確認できるアクティブなメールアドレス（個人のものではなく、配布グループや共有メールボックスが望ましい場合もある）を指定することが重要です。

### Microsoft 365 のリリース設定の管理

* **目的**: Microsoft 365 の新機能がテナントに展開されるタイミングを制御し、変更管理を計画的に行うため。
* **リリースオプション**:
    * **標準リリース (Standard release / General Availability)**:
        * 新機能が十分にテストされ、一般提供が開始された後にテナントに展開されます。
        * デフォルトの設定であり、ほとんどのユーザーに適しています。
        * 安定性を重視する場合に選択します。
    * **対象指定リリース (Targeted release / First Release)**:
        * 新機能が一般提供される前に、早期にテナントに展開されます。
        * 新機能をいち早く評価し、社内への展開準備やフィードバック提供を行いたい場合に選択します。
        * **2つのレベル**:
            * **対象指定リリース (組織全体)**: テナント内のすべてのユーザーが早期リリース対象となります。
            * **対象指定リリース (選択したユーザー)**: 特定のユーザー（IT部門、パワーユーザーなど）のみを早期リリース対象とすることができます。これが推奨されるテスト方法です。
* **設定方法 (Microsoft 365 管理センター)**:
    1.  `[設定]` > `[組織設定]` を選択します。
    2.  `[組織のプロファイル]` タブの `[リリースの設定]` をクリックします。
        <img width="1879" alt="image" src="https://github.com/user-attachments/assets/0354d6ab-9334-43db-87ce-63cdcf310ff0" />
    3.  いずれかのリリースオプションを選択します。
        * 「対象指定リリース (選択したユーザー)」を選択した場合は、対象ユーザーを指定します（通常、専用のグループを作成して割り当てます）。
    4.  変更を保存します。
* **考慮事項**:
    * 対象指定リリースを選択した場合、新機能の動作が不安定である可能性も考慮し、影響範囲を最小限に抑える（選択したユーザーにする）ことが重要です。
    * ユーザーへの事前通知とトレーニングの計画が必要です。

### テナント間移行の概要（参考知識）

* **シナリオ**:
    * 企業の合併・買収 (M&A) により、複数のテナントを統合する必要がある場合。
    * 事業の分割により、一部の部門を新しいテナントに分離する必要がある場合。
* **主な移行対象**: メールボックス、OneDriveデータ、SharePointサイト、Teamsデータ、Microsoft Entra IDユーザー・グループなど。
* **考慮事項**:
    * **複雑性**: テナント間移行は非常に複雑で、高度な計画と専門知識が必要です。
    * **データ損失リスク**: 慎重な作業が求められます。
    * **ダウンタイム**: サービスの停止が伴う場合があります。
    * **ID管理**: ユーザーIDの競合、認証方式の再設定など。
    * **コスト**: サードパーティ製の移行ツールやコンサルティングサービスの費用が発生することが一般的です。
* **Microsoftネイティブツールの限界**:
    * 現時点では、Microsoftから提供される包括的なテナント間移行ツールは限定的です。
    * メールボックス移行など一部機能は提供されていますが、多くの場合サードパーティツールが利用されます。
* **注意**: MS-102試験の直接的な出題範囲としては深掘りされにくいですが、大規模なMicrosoft 365環境を管理する上では概念として知っておくと役立ちます。

---

## 1.2 カスタムドメインの管理

### カスタムドメインの重要性

* **プロフェッショナルな印象**: `yourcompany.onmicrosoft.com` のような初期ドメインではなく、自社のブランド (`yourcompany.com`) を使用することで、顧客やパートナーに対して信頼性を高めます。
* **メールアドレスの統一**: 従業員のメールアドレスを `username@yourcompany.com` のように統一できます。
* **シングルサインオン体験の向上**: ユーザーが覚えやすい自社ドメインのUPNで各種サービスにサインオンできます。

### カスタムドメインの追加と検証プロセス

* **全体の流れ**:
    1.  **ドメインの準備**: ドメインレジストラー（例: GoDaddy, Namecheap, お名前.comなど）でカスタムドメインを所有していることを確認します。
    2.  **Microsoft 365 へのドメイン追加**: Microsoft 365 管理センターでドメイン名を追加します。
    3.  **ドメイン所有権の検証**: Microsoft 365 が提示するDNSレコード（TXTまたはMX）を、ドメインレジストラーのDNS管理画面に追加します。
    4.  **Microsoft 365 による検証**: Microsoft 365 がDNSレコードを確認し、所有権を検証します。
    5.  **サービスのDNSレコード設定 (オプション)**: Exchange OnlineやTeamsなどのサービスを利用するために、追加のDNSレコード（MX, CNAME, SRVなど）を設定します。
* **手順 (Microsoft 365 管理センター)**:
    1.  `[設定]` > `[ドメイン]` を選択します。
    2.  `[ドメインの追加]` をクリックします。
        <img width="717" alt="image" src="https://github.com/user-attachments/assets/0461e77a-cee2-4148-a091-d37797f7f66b" />
    3.  追加したいドメイン名（例: `contoso.com`）を入力し、`[このドメインを使用する]` をクリックします。
        <img width="974" alt="image" src="https://github.com/user-attachments/assets/5ba41d12-9086-4c49-8b4f-cfa8a07d6bfa" />
    4.  **ドメインの検証方法の選択**:
        * **TXTレコードを追加する (推奨)**: Microsoftが指定するTXTレコードの値（例: `MS=ms12345678`）をDNS設定に追加します。これが最も一般的で確実な方法です。
        * MXレコードを追加する: 既存のMXレコードを変更する必要があるため、メールサービスを既に利用している場合は注意が必要です。
        * テキスト ファイルをドメインの Web サイトに追加する: Webサーバーへのアクセスが必要です。
        　<img width="1122" alt="image" src="https://github.com/user-attachments/assets/704b95ef-305a-401d-97ba-59d0e96e5fe0" />
    5.  選択した検証方法に基づき、表示された値をドメインレジストラーのDNS管理画面に設定します。
        * **TXTレコードの場合**: ホスト名（通常は `@` またはドメイン名自体）、値（MS=...）、TTL（Time To Live、通常はデフォルトまたは1時間程度）を設定します。
            <img width="1107" alt="image" src="https://github.com/user-attachments/assets/41653e2d-3bb1-4283-ab68-e8412a5b142e" />
    6.  DNSレコードがインターネット上に伝播するまで待ちます（数分～最大72時間かかる場合がありますが、通常は数分～1時間程度）。
    7.  Microsoft 365 管理センターに戻り、`[確認]` をクリックします。
        * 検証に成功すると、ドメインが追加されます。
* **つまずきやすいポイントと対策**:
    * **DNSレコードの伝播遅延**: 設定後すぐに確認ボタンを押しても失敗することがあります。しばらく時間をおいて試します。
    * **TXTレコードのフォーマットミス**: 値を正確にコピー＆ペーストします。ホスト名の設定（`@` なのか、空白なのか、ドメイン名自体なのか）はDNSプロバイダーによって異なります。
    * **既存のDNSレコードとの競合**: 特にMXレコードで検証する場合、既存のメールフローに影響しないよう注意が必要です。
* **トラブルシューティング**:
    * **DNSルックアップツールの利用**: `nslookup` コマンド (Windows) やオンラインのDNSチェックツール (例: `mxtoolbox.com`) を使用して、設定したDNSレコードが正しく引けるか確認します。
    * Microsoft 365 管理センターの診断ツール。

### DNSレコードの種類と役割

* **MX (Mail Exchange) レコード**:
    * **役割**: 特定のドメイン宛のメールをどのメールサーバーに配送するかを指定します。
    * **Microsoft 365での設定**: カスタムドメインでExchange Onlineのメールを受信するために必須です。Microsoftが提供するMXレコードの値を設定します (例: `contoso-com.mail.protection.outlook.com`)。優先度も設定します。
* **CNAME (Canonical Name) レコード**:
    * **役割**: あるドメイン名（エイリアス）を別の正規のドメイン名に対応付けます。
    * **Microsoft 365での設定例**:
        * **Autodiscover**: `autodiscover.contoso.com` を `autodiscover.outlook.com` に向けることで、Outlookクライアントが自動的にメールボックス設定を検出できるようにします。
        * **Skype for Business Online / Teams**: `sip.contoso.com`, `lyncdiscover.contoso.com` など。
        * **Intune / MDM**: `enterpriseenrollment.contoso.com`, `enterpriseregistration.contoso.com` など。
* **TXT (Text) レコード**:
    * **役割**: ドメインに関する任意のテキスト情報を格納します。
    * **Microsoft 365での設定例**:
        * **ドメイン所有権の検証**: 上述の通り。
        * **SPF (Sender Policy Framework)**: `v=spf1 include:spf.protection.outlook.com -all` のように設定し、自ドメインから送信されるメールの正当な送信元サーバーを指定し、なりすましメールを防ぎます。
        * **DKIM (DomainKeys Identified Mail)**: (CNAMEレコードとして設定することが多い) 送信メールに電子署名を行い、改ざん防止と送信者の正当性を示します。
        * **DMARC (Domain-based Message Authentication, Reporting, and Conformance)**: SPFとDKIMの検証結果に基づき、受信側サーバーがメールをどう扱うべきか（隔離、拒否など）のポリシーを表明し、レポートを受信します。
* **SRV (Service) レコード**:
    * **役割**: 特定のサービス（プロトコルとポート番号）を提供するホストを指定します。
    * **Microsoft 365での設定例**: TeamsやSkype for Business Onlineで、フェデレーションや特定のクライアント機能のために必要となることがあります。

### 既定ドメインの変更

* **既定ドメインとは**:
    * 新しいユーザーを作成する際に、デフォルトで割り当てられるドメイン（例: `username@contoso.com`）。
    * 初期状態では `yourtenant.onmicrosoft.com` が既定ドメインです。
* **変更手順**:
    1.  Microsoft 365 管理センターで `[設定]` > `[ドメイン]` を選択します。
    2.  既定にしたい検証済みのカスタムドメインを選択します。
    3.  `[既定として設定]` をクリックします。
        <img width="904" alt="image" src="https://github.com/user-attachments/assets/ed678109-b5b7-4bfa-879e-4f09dc317172" />
* **影響**: 新規ユーザー作成時のデフォルトドメインが変わります。既存ユーザーのUPNやメールアドレスは自動的には変更されません。

### 複数のカスタムドメインの管理

* **シナリオ**:
    * 異なるブランドや子会社ごとにドメインを使い分けたい。
    * 合併により複数のドメインを統合管理する必要がある。
    * 特定のサービス（例: テスト用）に別のドメインを利用したい。
* **追加手順**: 基本的には最初のカスタムドメイン追加と同じ手順です。
* **考慮事項**:
    * 各ドメインごとにDNSレコードの設定と検証が必要です。
    * ユーザーのUPNやメールアドレスにどのドメインを使用するかを計画的に管理する必要があります。

### ハンズオン演習アイデア

* **演習1.1: カスタムドメインの追加と検証**
    1.  (可能であれば) 個人で所有しているか、テスト用のドメインを用意する。
    2.  Microsoft 365 開発者テナントに、そのドメインを追加する。
    3.  指定されたTXTレコードを、ドメインのDNS管理画面に設定する。
    4.  Microsoft 365 管理センターでドメインが検証されることを確認する。
* **演習1.2: Exchange OnlineのためのDNSレコード設定 (シミュレーション)**
    1.  カスタムドメイン `yourtestdomain.com` を使用すると仮定する。
    2.  Microsoft Learnなどのドキュメントを参考に、Exchange Online を利用するために必要なMXレコード、CNAME (Autodiscover)、TXT (SPF) レコードの「値」を調べる。
    3.  それらのレコードをDNS管理画面でどのように設定するかを紙に書き出すか、説明する。
        * **例**: MXレコード -> ホスト名: `@` または `yourtestdomain.com`, 値: `yourtestdomain-com.mail.protection.outlook.com`, 優先度: `0`
        * **例**: CNAMEレコード (Autodiscover) -> ホスト名: `autodiscover`, 値: `autodiscover.outlook.com`
        * **例**: TXTレコード (SPF) -> ホスト名: `@` または `yourtestdomain.com`, 値: `v=spf1 include:spf.protection.outlook.com -all`

---

## 1.3 ユーザーとグループの管理

### ユーザーアカウントの作成と管理

* **ユーザーアカウントの構成要素**:
    * **表示名**: Outlook や Teams などで表示される名前。
    * **ユーザープリンシパル名 (UPN)**: `username@domain.com` 形式のサインインID。通常、メールアドレスと一致させます。
    * **パスワード**: 初期パスワードの設定と、初回サインイン時の変更要求。
    * **ライセンス**: 割り当てるMicrosoft 365ライセンス。
    * **ロール**: 付与する管理者ロール（必要な場合）。
    * **その他属性**: 役職、部門、オフィス、電話番号など。これらの属性は動的グループやアドレス帳で使用されます。
* **作成方法**:
    * **Microsoft 365 管理センター**:
        1.  `[ユーザー]` > `[アクティブなユーザー]` を選択。
        2.  `[ユーザーの追加]` をクリック。
            <img width="1879" alt="image" src="https://github.com/user-attachments/assets/f7d1ca49-6072-47c5-a9ea-2345011f726a" />
        3.  必要な情報を入力し、ライセンス、オプション設定（ロールなど）を行います。
    * **Microsoft Entra 管理センター**:
        1.  `[ID]` > `[ユーザー]` > `[すべてのユーザー]` を選択。
        2.  `[新しいユーザー]` > `[新しいユーザーの作成]` をクリック。
            * より詳細なEntra ID固有の属性も設定可能です。
    * **一括作成 (CSVインポート)**: Microsoft 365 管理センターから
        1.  `[アクティブなユーザー]` ページで `[複数のユーザーを追加]` を選択。
        2.  サンプルCSVファイルをダウンロードし、ユーザー情報を入力してアップロードします。
            <img width="1879" alt="image" src="https://github.com/user-attachments/assets/ce3e1503-3ab2-40cc-807e-115e5002c9fd" />
        * **CSVファイルの必須列と推奨列**: UPN, DisplayName, FirstName, LastName など。
* **パスワードポリシーと管理**:
    * **Microsoft Entra ID のパスワードポリシー**: 文字数、複雑性、有効期限など。
        * セキュリティの既定値群が有効な場合は、基本的なポリシーが適用されます。
    * **パスワードリセット**: 管理者によるリセット、ユーザー自身によるリセット (SSPR、モジュール2で詳細)。
* **PowerShellによるユーザー管理**:
    * `Microsoft.Graph.Users` モジュール (Microsoft Graph PowerShell SDK)。
    * **接続**: `Connect-MgGraph -Scopes "User.ReadWrite.All"`
    * **ユーザー作成**: `New-MgUser -UserPrincipalName "newuser@contoso.com" -DisplayName "New User" -GivenName "New" -Surname "User" -AccountEnabled $true -PasswordProfile @{ForceChangePasswordNextSignIn=$true; Password="ComplexPassword123!"}`
    * **ユーザー情報取得**: `Get-MgUser -UserId "newuser@contoso.com"` または `Get-MgUser -Filter "startsWith(displayName,'New')"`
    * **ユーザー情報更新**: `Update-MgUser -UserId "newuser@contoso.com" -Department "Sales"`
    * **ユーザー削除**: `Remove-MgUser -UserId "newuser@contoso.com"`

### 外部ユーザー（ゲストアカウント）の管理

* **ゲストアカウントとは**: 組織外のユーザー（パートナー、ベンダー、顧客など）で、組織内のリソース（SharePointサイト、Teamsなど）へのアクセスを許可されたアカウント。
* **招待方法**:
    * SharePointサイトやTeamsから直接招待。
    * Microsoft Entra 管理センターでゲストユーザーとして作成・招待。
* **アクセス権と制限**: デフォルトでは、ゲストユーザーはメンバーよりも限定的な権限を持ちます。これらの権限は外部コラボレーション設定で調整可能です（詳細はモジュール2）。
* **ライフサイクル管理**:
    * 不要になったゲストアカウントの定期的な棚卸しと削除が重要です。
    * Microsoft Entra アクセスレビューを活用します（詳細はモジュール2）。

### 削除済みユーザーの復元

* **削除の仕組み**:
    * ユーザーを削除すると、まず「削除済みのユーザー」コンテナーに移動されます（論理削除）。
    * デフォルトで30日間保持され、この期間内であれば復元可能です。
    * 30日を過ぎると完全に削除され、復元できなくなります（一部例外を除く）。
* **復元手順 (Microsoft 365 管理センター)**:
    1.  `[ユーザー]` > `[削除済みのユーザー]` を選択します。
        <img width="907" alt="image" src="https://github.com/user-attachments/assets/06bd84c9-3701-49b0-9d03-2b0a1dcaf2c0" />
    2.  復元したいユーザーを選択し、`[ユーザーの復元]` をクリックします。
    3.  パスワードを自動生成するか、自分で作成するかを選択し、ライセンスを再割り当てします。
* **注意点**: ユーザーIDや一部の属性は復元されますが、メールボックスの内容などは復元タイミングやライセンス状況により動作が異なります（Exchange Onlineの回復可能なアイテムなど）。

### Microsoft 365 グループの種類と特徴

| グループ種類                 | 主な目的                                     | メールアドレス | SharePointサイト | Teams連携 | セキュリティ | 動的メンバーシップ |
| ---------------------------- | -------------------------------------------- | -------------- | ---------------- | --------- | ---------- | ---------------- |
| **Microsoft 365 グループ** | コラボレーション (メール、ファイル、チャット)    | あり           | あり             | 可能      | 可能       | ユーザー/デバイス |
| 配布グループ (配布リスト)    | メールの一斉配信                             | あり           | なし             | 不可      | 不可       | 不可             |
| セキュリティグループ         | リソースへのアクセス許可                     | なし(※1)       | なし             | 不可      | はい       | ユーザー/デバイス |
| メールが有効なセキュリティグループ | メール配信 + アクセス許可                    | あり           | なし             | 不可      | はい       | 不可             |

*※1 セキュリティグループ自体にはメールアドレスはありませんが、メンバーにメールを送信する別の仕組み（PowerShellなど）は考えられます。*

* **推奨**: 新規作成時は、コラボレーション目的なら「Microsoft 365 グループ」、アクセス権管理目的なら「セキュリティグループ」が基本です。

### グループの作成と管理

* **作成場所**:
    * Microsoft 365 管理センター (`[チームとグループ]` > `[アクティブなチームとグループ]`)
    * Microsoft Entra 管理センター (`[ID]` > `[グループ]`)
    * Exchange 管理センター (配布グループ、メールが有効なセキュリティグループ)
    * SharePoint 管理センター (Microsoft 365 グループに関連付けられたサイト作成時)
    * Teams クライアント (チーム作成時にMicrosoft 365 グループが自動生成)
* **Microsoft 365 グループ作成時の設定**:
    * **名前、説明**: グループの目的がわかるように。
    * **所有者**: グループを管理するユーザー。最低2名推奨。
    * **メンバー**: 初期メンバー。
    * **プライバシー**:
        * **パブリック**: 組織内の誰でも参加でき、コンテンツを閲覧可能。
        * **プライベート**: 所有者の承認がないと参加できず、コンテンツもメンバーのみ閲覧可能。
    * **Teamsとの連携**: グループ作成時にMicrosoft Teamsのチームを作成するかどうか。
        <img width="1081" alt="image" src="https://github.com/user-attachments/assets/45194186-0f30-440c-947b-10bb932a5e61" />
* **動的メンバーシップ (Dynamic Membership)**:
    * **対象**: Microsoft 365 グループ、セキュリティグループ。
    * **仕組み**: ユーザー属性（例: `department -eq "Sales"`）やデバイス属性（例: `deviceOSType -contains "Windows"`）に基づいて、メンバーを自動的に追加・削除します。
    * **ルール構文**: シンプルなルールはGUIで作成可能。複雑なルールはルール構文エディターで記述。
        <img width="1666" alt="image" src="https://github.com/user-attachments/assets/8d68f028-b2ff-4cf4-93b8-03e303e58290" />
    * **利点**: 手動でのメンバー管理の手間を削減し、正確性を向上。入退社や異動に伴う更新漏れを防ぎます。
    * **注意点**: ルールの検証とテストが重要。反映までに時間がかかる場合があります。
* **グループ設定**:
    * **命名ポリシー**: グループ名に接頭辞や接尾辞を付加したり、禁止ワードを設定したりできます（Entra ID Premium P1以上が必要）。
    * **有効期限ポリシー**: 一定期間アクティビティがないグループを自動的に削除（または所有者に更新を促す）できます（Entra ID Premium P1以上が必要）。
    * **ゲスト招待**: グループ所有者がゲストを招待できるか、メンバーがゲストを招待できるかなどを制御。
* **PowerShellによるグループ管理**:
    * `Microsoft.Graph.Groups` モジュール。
    * **グループ作成**: `New-MgGroup -DisplayName "Sales Department" -MailNickname "Sales" -SecurityEnabled:$false -MailEnabled:$true -GroupTypes "Unified"`
    * **メンバー追加**: `Add-MgGroupMember -GroupId "GROUP_ID" -DirectoryObjectId "USER_ID"`
    * **動的グループのルール設定**: `Set-MgGroup -GroupId "GROUP_ID" -MembershipRule 'user.department -eq "Sales"' -MembershipRuleProcessingState "On"`

### ハンズオン演習アイデア

* **演習1.3: テストユーザーの作成と管理**
    1.  Microsoft 365 管理センターで、3名のテストユーザー (例: UserA, UserB, UserC) を作成する。
    2.  各ユーザーに異なる部署 (`Sales`, `Marketing`, `IT`) と役職を設定する。
    3.  UserA のパスワードをリセットする。
    4.  UserB を (論理) 削除し、その後復元する。
* **演習1.4: Microsoft 365 グループの作成とメンバー管理**
    1.  「Marketing Project Team」というプライベートなMicrosoft 365 グループを作成する。
    2.  UserA と UserB をメンバーとして追加する。UserC を所有者として追加する。
    3.  このグループにメールを送信し、メンバーが受信できることを確認する（Outlookなど）。
    4.  グループに関連付けられたSharePointサイトが存在することを確認する。
* **演習1.5: 動的セキュリティグループの作成**
    1.  「Sales Department Users」という名前の動的セキュリティグループを作成する。
    2.  メンバーシップルールを「ユーザーの `department` 属性が `Sales` と等しい」と設定する。
    3.  `Sales` 部署に所属するテストユーザー (演習1.3で作成) が自動的にこのグループのメンバーになることを確認する（反映に時間がかかる場合あり）。
    4.  別のユーザーの部署を `Sales` に変更し、グループに自動追加されるか確認する。

---

## 1.4 ライセンス管理

### ライセンスの割り当てと解除

* **ライセンスとは**: Microsoft 365 の特定のサービスや機能を利用する権利。
* **サービスプラン**: 1つのライセンスには複数のサービスプランが含まれることがあります（例: Microsoft 365 E3ライセンスには Exchange Online Plan 2, SharePoint Online Plan 2 などが含まれる）。
* **手動での割り当て手順 (Microsoft 365 管理センター)**:
    1.  `[ユーザー]` > `[アクティブなユーザー]` を選択。
    2.  ライセンスを割り当てたいユーザーを選択（複数選択可）。
    3.  右側のペインで `[ライセンスとアプリ]` をクリック。
        <img width="693" alt="image" src="https://github.com/user-attachments/assets/c98b94ad-9e68-41c9-9798-b51bd9a9e743" />
    4.  割り当てるライセンスにチェックを入れます。
    5.  必要に応じて、そのライセンスに含まれる個別のアプリ（サービスプラン）のオン/オフを切り替えます。
        * **例**: Exchange Online のメールボックスは不要なユーザーには、Exchange Online Plan をオフにする。
    6.  `[変更の保存]` をクリックします。
* **解除**: 同様の手順で、ライセンスのチェックを外すか、個別のアプリをオフにします。

### グループベースのライセンス管理

* **目的**: ライセンス管理の自動化と効率化。ユーザーが特定のグループのメンバーになる/外れると、ライセンスが自動的に割り当て/解除されます。
* **仕組み**:
    1.  Microsoft Entra ID でセキュリティグループを作成します（または既存のグループを利用）。
    2.  そのグループに対して、割り当てたいライセンス（およびオプションで無効化するサービスプラン）を設定します。
    3.  ユーザーをそのグループに追加すると、ライセンスが自動的に割り当てられます。グループから削除すると解除されます。
* **設定手順 (Microsoft 365 管理センター)**:
    1.  `[課金情報]` >  `[ライセンス]` を選択します。
    2.  割り当てたいライセンス製品（例: Microsoft 365 E5）を選択します。
    3.  `[グループ]` をクリックし、`[+ ライセンス割り当て]` をクリックします。
        <img width="784" alt="image" src="https://github.com/user-attachments/assets/55c6cbd0-f011-4870-9122-1137cbbcfb0b" />
    4.  ライセンスを割り当てるグループを選択します。
    5.  **割り当てオプション**: 必要に応じて、特定のサービスプランをオフにします。
        <img width="439" alt="image" src="https://github.com/user-attachments/assets/08499a5d-dea3-4a66-8de8-d9a6b7cfc531" />
    6.  `[割り当て]` をクリックします。
* **ライセンスの競合**: ユーザーが複数のグループに所属し、異なるライセンス割り当て（特にサービスプランのオン/オフ）がある場合、競合が発生する可能性があります。Entra ID は競合を解決しようとしますが、意図しない結果になることもあるため、設計が重要です。
* **メリット**:
    * 新入社員へのライセンス割り当て漏れを防ぐ。
    * 退職者からのライセンス回収を確実にする。
    * 部門や役割に応じたライセンス設定を標準化できる。

### ライセンス使用状況の監視とレポート

* **重要性**: コスト最適化、コンプライアンス遵守。
* **確認場所 (Microsoft 365 管理センター)**:
    * `[課金]` > `[ライセンス]` (または `[お使いの製品]`):
        * 購入済みライセンス数、割り当て済みライセンス数、利用可能なライセンス数が表示されます。
        * `[スクリーンショット：ライセンス概要画面]`
    * `[レポート]` > `[利用状況レポート]`:
        * Microsoft 365 全体、またはサービスごとのアクティブユーザー数、利用状況の推移などを確認できます。
        * 「Microsoft 365 アクティブ ユーザー」レポート、「Exchange メール アクティビティ」レポートなど。
* **未使用ライセンスの特定**: 割り当て済みだが実際には利用されていない（サインインがない、アクティビティがない）ライセンスを特定し、再割り当てや削減を検討します。
* **ライセンスの調整**: 必要に応じてライセンス数を増減させたり、プランを変更したりします（契約による）。

### PowerShellによるライセンス管理

* `Microsoft.Graph.Users` および関連モジュール。
* **ユーザーにライセンスを割り当て/変更**:
    * `Set-MgUserLicense -UserId "USER_ID" -AddLicenses @{SkuId = "SKU_ID_OF_LICENSE"} -RemoveLicenses @()`
    * SKU ID を取得するには `Get-MgSubscribedSku` を使用します。
* **ユーザーのライセンス情報を取得**: `Get-MgUserLicenseDetail -UserId "USER_ID"`
* **グループベースライセンスの設定**: `Set-MgGroupLicense -GroupId "GROUP_ID" -AddLicenses @{SkuId = "SKU_ID"} -RemoveLicenses @()` (コマンドレット名やパラメータはSDKバージョンにより若干異なる可能性あり。Graph API直接操作がより柔軟な場合も)

### ハンズオン演習アイデア

* **演習1.6: ユーザーへの手動ライセンス割り当てとサービスプラン変更**
    1.  テストユーザー (例: UserA) に Microsoft 365 E3 (または開発者テナントで利用可能な上位ライセンス) を割り当てる。
    2.  割り当て後、UserA のライセンス設定を開き、「Yammer Enterprise」サービスプランのみを無効化する。
    3.  UserA でサインインし、Yammer にアクセスできないことを確認する（反映に時間がかかる場合あり）。
* **演習1.7: グループベースのライセンス割り当て**
    1.  「E3 Licensed Users」という名前のセキュリティグループを作成する。
    2.  このグループに Microsoft 365 E3 ライセンスを割り当てる（Microsoft Entra 管理センター経由）。
    3.  テストユーザー (例: UserC) をこのグループに追加する。
    4.  しばらく待ってから、UserC にライセンスが自動的に割り当てられていること、およびデフォルトのサービスプランが有効になっていることを確認する。
    5.  UserC をグループから削除し、ライセンスが自動的に解除されることを確認する。

---

## 1.5 ロールとロールグループの管理

### 組み込みロールの概要と種類

* **目的**: Microsoft 365 の管理タスクを、権限を分担して安全かつ効率的に行うため。
* **最小権限の原則 (Principle of Least Privilege)**: ユーザーや管理者には、その職務遂行に必要な最小限の権限のみを付与すべきというセキュリティの基本原則。グローバル管理者のような強力な権限を持つアカウントは最小限に留めるべきです。
* **主要な組み込みロール (Microsoft 365 / Entra ID)**:

    | ロール名                 | 主な権限・責任                                                                | 影響範囲         |
    | ------------------------ | ----------------------------------------------------------------------------- | ---------------- |
    | グローバル管理者         | すべての管理機能へのフルアクセス。最も強力なロール。慎重に割り当てる。             | テナント全体     |
    | 課金管理者               | サブスクリプションの管理、購入、請求に関する管理。                               | 課金関連         |
    | Exchange 管理者          | Exchange Online の設定、メールボックス、メールフローなどの管理。                   | Exchange Online  |
    | SharePoint 管理者        | SharePoint Online と OneDrive for Business の設定、サイトコレクションの管理。    | SharePoint/OneDrive |
    | Teams 管理者             | Microsoft Teams の設定、ポリシー、通話機能などの管理。                           | Teams            |
    | ユーザー管理者           | ユーザーアカウントの作成、削除、パスワードリセット、グループ管理（一部）。         | ユーザー/グループ |
    | ヘルプデスク管理者 (パスワード管理者) | ユーザーのパスワードリセット、サービス正常性の確認など、一般的なサポート業務。 | ユーザーサポート   |
    | セキュリティ管理者       | Microsoft Defender XDR, Microsoft Purviewなどのセキュリティ関連機能の管理。 | セキュリティ機能 |
    | コンプライアンス管理者   | Microsoft Purview のコンプライアンス関連機能（DLP, eDiscoveryなど）の管理。  | コンプライアンス機能 |
    | グローバル閲覧者         | すべての管理設定を閲覧できるが、変更はできない。監査や監視目的。                   | テナント全体(閲覧) |
    * *より詳細なリストと各ロールの権限については、Microsoft Learn のドキュメントを参照してください。*

### ロールの割り当てと管理

* **割り当て方法**:
    * **Microsoft 365 管理センター**: `[ロール]` > `[ロールの割り当て]`。主要なロールが表示されます。
        * `[スクリーンショット：M365管理センターのロール割り当て画面]`
    * **Microsoft Entra 管理センター**: `[ID]` > `[ロールと管理者]`。より多くのEntra ID固有ロールとMicrosoft 365ロールが表示され、詳細な権限も確認できます。
        * `[スクリーンショット：Entra管理センターのロール一覧と割り当て画面]`
    1.  割り当てたいロールを選択します。
    2.  `[割り当ての追加]` をクリックし、対象のユーザーまたはロール割り当て可能なグループを選択します。
* **ロール割り当て可能なグループ**:
    * Microsoft Entra ID Premium P1以上で利用可能。
    * セキュリティグループまたはメールが有効なセキュリティグループに「isAssignableToRole」プロパティを設定することで、そのグループにロールを割り当てることができます。
    * グループのメンバーに間接的にロールが付与されるため、メンバー管理で権限管理が容易になります。
* **PIM (Privileged Identity Management) の利用推奨**: グローバル管理者などの強力なロールは、PIMを使用してJust-In-Timeアクセスを構成することを強く推奨します（詳細はモジュール2.3で触れます）。

### カスタムロールの作成と管理 (Microsoft Entra ID)

* **目的**: 組み込みロールでは権限が広すぎる、または細かすぎる場合に、特定のタスクに必要な権限だけを持つカスタムロールを作成します。
* **利用シーン**:
    * 特定のアプリケーションの登録や管理のみを行うロール。
    * ユーザーの特定の属性のみを編集できるロール。
* **作成手順 (Microsoft Entra 管理センター)**:
    1.  `[ID]` > `[ロールと管理者]` を選択します。
    2.  `[新しいカスタム ロール]` をクリックします。
        * `[スクリーンショット：カスタムロールの新規作成開始画面]`
    3.  **基本**: ロール名と説明を入力します。
    4.  **アクセス許可**: 利用可能な権限の一覧から、このロールに含めたい具体的な権限を選択します。検索やフィルタリングが可能です。
        * `[スクリーンショット：カスタムロールのアクセス許可選択画面]`
        * **注意**: 権限は非常に細かく定義されています。必要な権限を正確に選択することが重要です。
    5.  **割り当て**: 作成したカスタムロールをユーザーやグループに割り当てます（後からでも可）。
    6.  確認して作成します。
* **注意点**: カスタムロールは強力な機能ですが、権限の設計と管理には注意が必要です。過不足なく、かつ最小権限の原則に従うようにします。

### 管理単位 (Administrative Units) との連携

* **目的**: Microsoft Entra ID内のリソース（ユーザー、グループ、デバイス）を「管理単位」というコンテナーにまとめ、その管理単位の範囲内でのみ特定の管理者ロールの権限が有効になるようにスコープを制限します。
* **利用シナリオ**:
    * **地理的分割**: 東京支社のIT担当者には、東京支社のユーザーに対する「ユーザー管理者」権限のみを与える。
    * **部門別管理**: 研究開発部門のマネージャーには、研究開発部門のグループに対する「グループ管理者」権限のみを与える。
* **仕組み**:
    1.  管理単位を作成し、対象となるユーザー、グループ、デバイスをメンバーとして追加します。
        * `[スクリーンショット：管理単位の作成とメンバー追加画面]`
    2.  管理者ロールをユーザーに割り当てる際に、そのロールの「スコープ」として作成した管理単位を指定します。
        * `[スクリーンショット：ロール割り当て時のスコープ指定画面]`
* **メリット**:
    * グローバルな管理者権限を持つアカウントを減らし、セキュリティを向上させます。
    * 権限委任をより細かく制御できます。
* **制限事項**:
    * すべてのリソースタイプやロールが管理単位のスコープに対応しているわけではありません。対応状況はドキュメントで確認が必要です。
    * 管理単位のメンバーシップは手動または動的（ユーザー属性に基づく）に設定できます。

### Privileged Identity Management (PIM) の概要

* **目的**: 特権アクセス（管理者ロール）の管理、制御、監視を行い、過剰な永続的特権に伴うリスクを軽減します。
* **主要機能**:
    * **Just-In-Time (JIT) アクセス**: 必要な時にのみ期間限定でロールをアクティブ化。
    * **承認ワークフロー**: ロールのアクティブ化に際して承認を要求。
    * **時間制限付き割り当て**: ロールの割り当て自体に有効期限を設定。
    * **アクセスレビュー**: 特権ロールの割り当ての定期的な棚卸し。
    * **アラートと監査**: 特権アクティビティの監視。
* **対象**: Microsoft Entra ID ロール、Azureリソースロール、PIM for Groups。
* *モジュール2.3「セキュアアクセスの実装と管理」のID Protectionと条件付きアクセスと合わせて、特権アクセス戦略の中核となる機能です。MS-102ではPIMの基本的な概念とEntra IDロールでの利用が問われる可能性があります。*

### ハンズオン演習アイデア

* **演習1.8: 組み込みロールの割り当てと確認**
    1.  テストユーザー (例: UserA) に「ヘルプデスク管理者」ロールを割り当てる。
    2.  UserA でMicrosoft 365 管理センターにサインインし、他のユーザーのパスワードリセットが可能であること、しかし他の管理機能（例: 課金設定）にはアクセスできないことを確認する。
    3.  UserA からロールを解除する。
* **演習1.9: 管理単位の作成とスコープ付きロール割り当て (概念理解)**
    1.  「Tokyo Office Users」という名前の管理単位を作成する。
    2.  いくつかのテストユーザーをこの管理単位のメンバーとして追加する。
    3.  別のテストユーザー (例: TokyoAdminUser) に「ユーザー管理者」ロールを割り当てる際、スコープを「Tokyo Office Users」管理単位に限定する設定がどこにあるかを確認する（実際に割り当てて動作確認するには、TokyoAdminUserが管理単位内のユーザーを管理できるかテストする）。
* **演習1.10: (可能であればP2ライセンス環境で) PIMによるロールの適格な割り当てとアクティブ化体験**
    1.  テストユーザーに、PIMを通じて「Exchange 管理者」ロールを「適格 (Eligible)」として割り当てる。
    2.  そのテストユーザーとしてサインインし、PIMポータルからロールをアクティブ化する手順を体験する。
    3.  アクティブ化後、Exchange 管理センターにアクセスできることを確認し、アクティブ化の有効期限が切れるとアクセスできなくなることを確認する。

---

## 1.6 サービス正常性とメッセージセンターの監視

### サービス正常性ダッシュボードの確認

* **目的**: Microsoft 365 サービスの現在の状態、障害情報、メンテナンス予定などを一元的に把握し、ユーザーへの影響を評価・通知するため。
* **アクセス方法**: Microsoft 365 管理センターの左側ナビゲーションから `[正常性]` > `[サービス正常性]`。
    * `[スクリーンショット：サービス正常性ダッシュボードのメイン画面]`
* **表示内容**:
    * **すべてのサービスの状態**: 主要なサービス（Exchange Online, SharePoint Online, Teamsなど）の現在の状態が一目でわかります（正常、アドバイザリ、インシデントなど）。
    * **アクティブな問題**:
        * **インシデント**: サービスが利用できない、または大幅に機能が低下している状態。通常、広範囲な影響があります。
        * **アドバイザリ**: サービスは利用可能だが、一部機能に問題がある、またはパフォーマンスが低下している状態。影響は限定的であることがあります。
    * **問題の詳細**: 各インシデントやアドバイザリをクリックすると、以下の情報が表示されます。
        * **ユーザーへの影響**: 具体的にどのような影響が出ているか。
        * **現在の状態**: Microsoft が問題を調査中か、修正を展開中か、解決済みかなど。
        * **回避策**: ユーザーが問題を回避するために取れる一時的な手段（もしあれば）。
        * **次の更新**: Microsoft から次の情報更新がいつ頃提供されるかの目安。
        * **インシデントID**: サポート問い合わせ時に使用します (例: EX123456)。
    * **履歴**: 過去7日間または30日間のインシデントとアドバイザリの履歴を確認できます。
* **情報の解釈と対応**:
    * インシデント発生時は、まずユーザーへの影響範囲を確認し、必要に応じて組織内に情報を共有します。
    * 提示されている回避策があれば、ユーザーに案内します。
    * Microsoft の対応状況を定期的に確認します。

### 通知設定のカスタマイズ

* **目的**: サービス正常性に関する重要な情報をメールでタイムリーに受け取るため。
* **設定方法**:
    1.  サービス正常性ダッシュボードで `[基本設定]` (または `[通知のカスタマイズ]`) をクリックします。
    2.  `[メール]` タブを選択します。
    3.  通知を受け取りたいメールアドレス（最大2つ）を入力します。
    4.  通知を受けたい**サービス**（例: Exchange Online, Microsoft Teams のみ）を選択します。
    5.  通知を受けたい**問題の種類**（インシデント、アドバイザリ）を選択します。
        * `[スクリーンショット：サービス正常性通知のメール設定画面]`
    6.  設定を保存します。
* **ベストプラクティス**: IT管理チームの配布リストや共有メールボックスを通知先に設定し、複数の担当者で情報を共有できるようにします。

### メッセージセンターの活用

* **目的**: Microsoft 365 の今後の変更、新機能のリリース、メンテナンス予定、管理者が対応すべき事項（例: 非推奨になる機能への対応）など、運用上重要な情報をMicrosoftから受け取るため。
* **アクセス方法**: Microsoft 365 管理センターの左側ナビゲーションから `[正常性]` > `[メッセージセンター]`。
    * `[スクリーンショット：メッセージセンターのメイン画面]`
* **表示内容**:
    * **メッセージの一覧**: 各メッセージにはタイトル、メッセージID、発行日、カテゴリ（計画的変更、情報提供など）、影響を受けるサービスなどが表示されます。
    * **メッセージの詳細**: メッセージをクリックすると、変更の概要、ユーザーへの影響、管理者が行うべき作業、関連情報へのリンクなどが表示されます。
    * **主要な更新 (Major Updates)**: 特に影響が大きい変更は「主要な更新」としてマークされます。
* **効果的な活用方法**:
    * **定期的な確認**: 最低でも週に一度は確認することを推奨します。
    * **フィルタリング**: サービスやタグでメッセージを絞り込み、関心のある情報を見つけやすくします。
    * **アクションの追跡**: 「対応が必要な作業」が含まれるメッセージについては、対応計画を立て、完了まで追跡します。
    * **共有**: 関連するメッセージを組織内の他の担当者（例: 特定のサービス管理者、変更管理チーム）と共有します。
    * **週刊ダイジェスト**: メールでメッセージセンターの概要を受け取るように設定できます。
* **注意点**: メッセージセンターの情報は多岐にわたるため、自組織に本当に関連性の高い情報を見極めることが重要です。

### Microsoft 365 アプリの正常性ダッシュボード (参考知識)

* **目的**: Microsoft 365 Apps for enterprise (Officeアプリ) の利用状況、パフォーマンス、セキュリティ更新プログラムの適用状況などを可視化し、問題の特定や最適化を支援します（特定のライセンスが必要な場合があります）。
* **確認できる情報例**:
    * アプリのバージョン分布
    * クラッシュ率
    * アドインのパフォーマンス
* これはサービス全体の障害情報とは異なり、クライアントアプリ側の状態に焦点を当てています。

### ハンズオン演習アイデア

* **演習1.10: サービス正常性ダッシュボードの探索**
    1.  Microsoft 365 管理センターでサービス正常性ダッシュボードを開く。
    2.  現在アクティブなインシデントやアドバイザリがないか確認する（もしあれば、その詳細を読む）。
    3.  「履歴」タブで、過去30日間のインシデントをいくつか探し、どのような情報（ユーザーへの影響、根本原因、解決策など）が提供されていたかを確認する。
* **演習1.11: メッセージセンターの確認と対応計画シミュレーション**
    1.  メッセージセンターを開く。
    2.  「計画的変更」または「対応が必要な作業」のカテゴリで、最近のメッセージをいくつか読む。
    3.  そのうちの1つを選び、もし自分の組織でこの変更に対応する必要がある場合、どのようなステップで対応を進めるか（情報収集、関係者への通知、テスト、展開など）を簡単に計画してみる。
* **演習1.12: サービス正常性通知の設定**
    1.  サービス正常性通知の設定画面を開く。
    2.  自分のメールアドレス（またはテスト用アドレス）を登録し、Exchange Online と Microsoft Teams のインシデントに関する通知のみを受け取るように設定する。

---
